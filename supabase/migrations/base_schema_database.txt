-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.ai_provider_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id text NOT NULL UNIQUE,
  default_provider text NOT NULL DEFAULT 'openai'::text CHECK (default_provider = ANY (ARRAY['openai'::text, 'gemini'::text, 'anthropic'::text, 'custom'::text])),
  openai_config jsonb DEFAULT '{"model": "gpt-3.5-turbo", "api_key": "", "max_tokens": 1000, "temperature": 0.7}'::jsonb,
  gemini_config jsonb DEFAULT '{"model": "gemini-pro", "api_key": "", "max_tokens": 1000, "temperature": 0.7}'::jsonb,
  anthropic_config jsonb DEFAULT '{"model": "claude-3-sonnet-20240229", "api_key": "", "max_tokens": 1000, "temperature": 0.7}'::jsonb,
  custom_ai_config jsonb DEFAULT '{"model": "custom", "api_key": "", "max_tokens": 1000, "temperature": 0.7, "api_endpoint": ""}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_provider_settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.analytics_alerts_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid,
  alert_type text NOT NULL,
  threshold_value numeric,
  is_enabled boolean DEFAULT true,
  notification_methods jsonb DEFAULT '["email", "dashboard"]'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT analytics_alerts_config_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_alerts_config_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.analytics_metrics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid,
  metric_type text NOT NULL,
  metric_value numeric DEFAULT 0,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT analytics_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_metrics_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.analytics_notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid,
  notification_type text NOT NULL,
  title text NOT NULL,
  message text NOT NULL,
  is_read boolean DEFAULT false,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT analytics_notifications_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_notifications_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.analytics_views (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid,
  page_path text NOT NULL,
  page_title text,
  user_agent text,
  ip_address inet,
  referrer text,
  view_count integer NOT NULL DEFAULT 1,
  session_id text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT analytics_views_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_views_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.bulk_import_jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  user_id uuid NOT NULL,
  filename text NOT NULL,
  file_size bigint NOT NULL,
  total_products integer DEFAULT 0,
  processed_products integer DEFAULT 0,
  successful_products integer DEFAULT 0,
  failed_products integer DEFAULT 0,
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'cancelled'::text])),
  config jsonb NOT NULL DEFAULT '{}'::jsonb,
  error_message text,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bulk_import_jobs_pkey PRIMARY KEY (id),
  CONSTRAINT bulk_import_jobs_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT bulk_import_jobs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.bulk_import_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_id uuid NOT NULL,
  row_number integer NOT NULL,
  product_name text,
  sku text,
  status text NOT NULL CHECK (status = ANY (ARRAY['success'::text, 'error'::text, 'warning'::text])),
  message text NOT NULL,
  data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bulk_import_logs_pkey PRIMARY KEY (id),
  CONSTRAINT bulk_import_logs_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.bulk_import_jobs(id)
);
CREATE TABLE public.bulk_import_temp_products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_id uuid NOT NULL,
  row_number integer NOT NULL,
  product_data jsonb NOT NULL,
  variations_data jsonb DEFAULT '[]'::jsonb,
  validation_status text NOT NULL DEFAULT 'pending'::text CHECK (validation_status = ANY (ARRAY['pending'::text, 'valid'::text, 'invalid'::text])),
  validation_errors jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bulk_import_temp_products_pkey PRIMARY KEY (id),
  CONSTRAINT bulk_import_temp_products_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.bulk_import_jobs(id)
);
CREATE TABLE public.catalog_banners (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  image_url text NOT NULL,
  link_url text,
  banner_type text NOT NULL DEFAULT 'hero'::text,
  position integer NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  display_order integer NOT NULL DEFAULT 0,
  start_date timestamp with time zone,
  end_date timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  product_id uuid,
  source_type text DEFAULT 'manual'::text CHECK (source_type = ANY (ARRAY['manual'::text, 'product'::text])),
  CONSTRAINT catalog_banners_pkey PRIMARY KEY (id),
  CONSTRAINT catalog_banners_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.catalogs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  type USER-DEFINED NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  template_name text DEFAULT 'default'::text,
  custom_settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT catalogs_pkey PRIMARY KEY (id),
  CONSTRAINT catalogs_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.coupons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  code text NOT NULL,
  description text,
  discount_type text NOT NULL CHECK (discount_type = ANY (ARRAY['percentage'::text, 'fixed'::text])),
  discount_value numeric NOT NULL,
  min_order_amount numeric DEFAULT 0.00,
  max_uses integer,
  current_uses integer NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  expires_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT coupons_pkey PRIMARY KEY (id),
  CONSTRAINT coupons_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  email text,
  phone text NOT NULL,
  store_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT customers_pkey PRIMARY KEY (id),
  CONSTRAINT customers_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.feature_usage (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  feature_type USER-DEFINED NOT NULL,
  current_usage integer NOT NULL DEFAULT 0,
  period_start timestamp with time zone NOT NULL DEFAULT date_trunc('month'::text, now()),
  period_end timestamp with time zone NOT NULL DEFAULT (date_trunc('month'::text, now()) + '1 mon'::interval),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT feature_usage_pkey PRIMARY KEY (id),
  CONSTRAINT feature_usage_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.n8n_webhooks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  webhook_type text NOT NULL UNIQUE CHECK (webhook_type = ANY (ARRAY['order_notifications'::text, 'whatsapp_integration'::text, 'system_notifications'::text])),
  webhook_url text NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT n8n_webhooks_pkey PRIMARY KEY (id)
);
CREATE TABLE public.orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  customer_name text NOT NULL,
  customer_email text,
  customer_phone text,
  total_amount numeric NOT NULL DEFAULT 0.00,
  status USER-DEFINED NOT NULL DEFAULT 'pending'::order_status,
  order_type USER-DEFINED NOT NULL DEFAULT 'retail'::catalog_type,
  items jsonb NOT NULL DEFAULT '[]'::jsonb,
  shipping_address jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  stock_reserved boolean NOT NULL DEFAULT false,
  reservation_expires_at timestamp with time zone,
  notes text,
  shipping_method text,
  payment_method text,
  shipping_cost numeric DEFAULT 0.00,
  tracking_code text,
  label_generated_at timestamp with time zone,
  label_generated_by uuid,
  picking_list_printed_at timestamp with time zone,
  picking_list_printed_by uuid,
  content_declaration_printed_at timestamp with time zone,
  content_declaration_printed_by uuid,
  receipt_printed_at timestamp with time zone,
  receipt_printed_by uuid,
  delivery_status text DEFAULT 'preparing'::text,
  estimated_delivery_date date,
  carrier text,
  delivery_address jsonb,
  whatsapp_message_sent boolean DEFAULT false,
  whatsapp_number text,
  CONSTRAINT orders_pkey PRIMARY KEY (id),
  CONSTRAINT orders_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT orders_label_generated_by_fkey FOREIGN KEY (label_generated_by) REFERENCES public.profiles(id),
  CONSTRAINT orders_picking_list_printed_by_fkey FOREIGN KEY (picking_list_printed_by) REFERENCES public.profiles(id),
  CONSTRAINT orders_content_declaration_printed_by_fkey FOREIGN KEY (content_declaration_printed_by) REFERENCES public.profiles(id),
  CONSTRAINT orders_receipt_printed_by_fkey FOREIGN KEY (receipt_printed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.payment_gateways (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL CHECK (name = ANY (ARRAY['stripe'::text, 'asaas'::text])),
  is_active boolean NOT NULL DEFAULT false,
  config jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT payment_gateways_pkey PRIMARY KEY (id)
);
CREATE TABLE public.payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  amount numeric NOT NULL,
  payment_method text NOT NULL CHECK (payment_method = ANY (ARRAY['pix'::text, 'money'::text, 'card'::text, 'bank_slip'::text])),
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'confirmed'::text, 'failed'::text, 'refunded'::text])),
  reference_id text,
  confirmed_by uuid,
  confirmed_at timestamp with time zone,
  due_date timestamp with time zone,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  mercadopago_payment_id text,
  mercadopago_preference_id text,
  mercadopago_collection_id text,
  mercadopago_status text,
  mercadopago_response jsonb,
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id),
  CONSTRAINT payments_confirmed_by_fkey FOREIGN KEY (confirmed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.plan_benefits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid NOT NULL,
  benefit_id uuid NOT NULL,
  limit_value text,
  is_enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT plan_benefits_pkey PRIMARY KEY (id),
  CONSTRAINT plan_benefits_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.subscription_plans(id),
  CONSTRAINT plan_benefits_benefit_id_fkey FOREIGN KEY (benefit_id) REFERENCES public.system_benefits(id)
);
CREATE TABLE public.plan_features (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid NOT NULL,
  feature_type USER-DEFINED NOT NULL,
  feature_value text,
  is_enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT plan_features_pkey PRIMARY KEY (id),
  CONSTRAINT plan_features_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.subscription_plans(id)
);
CREATE TABLE public.plan_payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  plan_id uuid NOT NULL,
  gateway text NOT NULL CHECK (gateway = ANY (ARRAY['stripe'::text, 'asaas'::text])),
  amount numeric NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'completed'::text, 'failed'::text, 'cancelled'::text, 'refunded'::text])),
  gateway_payment_id text,
  gateway_response jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT plan_payments_pkey PRIMARY KEY (id),
  CONSTRAINT plan_payments_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT plan_payments_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.subscription_plans(id)
);
CREATE TABLE public.product_care_instructions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  instruction_type text NOT NULL CHECK (instruction_type = ANY (ARRAY['do'::text, 'dont'::text, 'warning'::text])),
  icon_type text NOT NULL CHECK (icon_type = ANY (ARRAY['water'::text, 'sun'::text, 'iron'::text, 'wash'::text, 'dry'::text, 'bleach'::text, 'protect'::text, 'custom'::text])),
  instruction_text text NOT NULL,
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_care_instructions_pkey PRIMARY KEY (id),
  CONSTRAINT product_care_instructions_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_grade_models (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  grade_name text NOT NULL,
  sizes jsonb NOT NULL,
  quantities jsonb NOT NULL,
  color text,
  min_order integer DEFAULT 1,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_grade_models_pkey PRIMARY KEY (id),
  CONSTRAINT product_grade_models_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_images (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  variation_id uuid,
  image_url text NOT NULL,
  image_order integer NOT NULL DEFAULT 1 CHECK (image_order >= 1 AND image_order <= 10),
  alt_text text,
  is_primary boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  display_order integer DEFAULT 1,
  is_variation_image boolean DEFAULT false,
  color_association text,
  CONSTRAINT product_images_pkey PRIMARY KEY (id),
  CONSTRAINT product_images_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT product_images_variation_id_fkey FOREIGN KEY (variation_id) REFERENCES public.product_variations(id)
);
CREATE TABLE public.product_price_tiers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid,
  tier_name character varying NOT NULL,
  tier_order integer NOT NULL CHECK (tier_order >= 1 AND tier_order <= 4),
  tier_type character varying NOT NULL,
  price numeric NOT NULL,
  min_quantity integer NOT NULL DEFAULT 1 CHECK (min_quantity >= 1),
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_price_tiers_pkey PRIMARY KEY (id),
  CONSTRAINT product_price_tiers_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_size_charts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  size_name text NOT NULL,
  size_br text,
  size_us text,
  size_eu text,
  size_cm text,
  measurements jsonb,
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_size_charts_pkey PRIMARY KEY (id),
  CONSTRAINT product_size_charts_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_testimonials (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  customer_name text NOT NULL,
  customer_email text,
  customer_city text NOT NULL,
  customer_state text,
  customer_avatar text,
  rating numeric NOT NULL CHECK (rating >= 1::numeric AND rating <= 5::numeric),
  comment text NOT NULL,
  purchase_date date NOT NULL,
  verified_purchase boolean DEFAULT false,
  helpful_count integer DEFAULT 0,
  is_featured boolean DEFAULT false,
  is_approved boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_testimonials_pkey PRIMARY KEY (id),
  CONSTRAINT product_testimonials_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_variations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  color text,
  size text,
  sku text,
  stock integer NOT NULL DEFAULT 0,
  price_adjustment numeric DEFAULT 0.00,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  image_url text,
  variation_group_id uuid,
  parent_variation_id uuid,
  variation_type text DEFAULT 'simple'::text,
  display_order integer DEFAULT 0,
  variation_value text,
  hex_color text,
  variation_name text,
  sort_order integer DEFAULT 0,
  name text,
  is_grade boolean DEFAULT false,
  grade_name text,
  grade_color text,
  grade_quantity integer,
  grade_sizes jsonb,
  grade_pairs jsonb,
  flexible_grade_config jsonb,
  grade_sale_mode character varying DEFAULT 'full'::character varying CHECK ((grade_sale_mode::text = ANY (ARRAY['full'::character varying, 'half'::character varying, 'custom'::character varying]::text[])) OR grade_sale_mode IS NULL),
  CONSTRAINT product_variations_pkey PRIMARY KEY (id),
  CONSTRAINT product_variations_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT product_variations_parent_variation_id_fkey FOREIGN KEY (parent_variation_id) REFERENCES public.product_variations(id)
);
CREATE TABLE public.product_videos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  video_url text NOT NULL,
  video_type text NOT NULL CHECK (video_type = ANY (ARRAY['youtube'::text, 'vimeo'::text, 'direct'::text])),
  thumbnail_url text,
  title text,
  description text,
  duration_seconds integer,
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_videos_pkey PRIMARY KEY (id),
  CONSTRAINT product_videos_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  category text,
  retail_price numeric NOT NULL DEFAULT 0.00,
  wholesale_price numeric,
  stock integer NOT NULL DEFAULT 0,
  min_wholesale_qty integer DEFAULT 1,
  image_url text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  meta_title text,
  meta_description text,
  keywords text,
  seo_slug text,
  reserved_stock integer NOT NULL DEFAULT 0,
  allow_negative_stock boolean NOT NULL DEFAULT false,
  stock_alert_threshold integer DEFAULT 5,
  is_featured boolean DEFAULT false,
  bulk_price_small numeric,
  bulk_price_large numeric,
  barcode text,
  sku text,
  weight numeric,
  width numeric,
  height numeric,
  depth numeric,
  tags ARRAY,
  ai_generated_description boolean DEFAULT false,
  auto_seo_slug boolean DEFAULT false,
  generated_keywords ARRAY,
  enable_gradual_wholesale boolean DEFAULT false,
  product_gender text CHECK (product_gender = ANY (ARRAY['masculino'::text, 'feminino'::text, 'unissex'::text, 'infantil'::text])),
  product_category_type text CHECK (product_category_type = ANY (ARRAY['calcado'::text, 'roupa_superior'::text, 'roupa_inferior'::text, 'acessorio'::text])),
  has_custom_size_chart boolean DEFAULT false,
  material text,
  product_weight numeric,
  dimensions jsonb,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  email text NOT NULL,
  full_name text,
  role USER-DEFINED NOT NULL DEFAULT 'store_admin'::user_role,
  store_id uuid,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT fk_profiles_store_id FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.stock_movements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  order_id uuid,
  movement_type text NOT NULL CHECK (movement_type = ANY (ARRAY['reservation'::text, 'sale'::text, 'return'::text, 'adjustment'::text, 'release'::text])),
  quantity integer NOT NULL,
  previous_stock integer NOT NULL,
  new_stock integer NOT NULL,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  expires_at timestamp with time zone,
  store_id uuid NOT NULL,
  CONSTRAINT stock_movements_pkey PRIMARY KEY (id),
  CONSTRAINT stock_movements_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT stock_movements_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id),
  CONSTRAINT stock_movements_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.store_ai_prompts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  prompt_type text NOT NULL CHECK (prompt_type = ANY (ARRAY['description'::text, 'seo'::text, 'keywords'::text])),
  prompt_template text NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT store_ai_prompts_pkey PRIMARY KEY (id),
  CONSTRAINT store_ai_prompts_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.store_order_bump_configs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  product_id uuid NOT NULL,
  is_active boolean DEFAULT true,
  discount_percentage numeric DEFAULT 0.00,
  urgency_text text,
  social_proof_text text,
  is_limited_time boolean DEFAULT false,
  limited_quantity integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  bundle_price numeric,
  trigger_conditions jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT store_order_bump_configs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.store_payment_methods (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  name character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  is_active boolean DEFAULT true,
  config jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  bank_info jsonb,
  CONSTRAINT store_payment_methods_pkey PRIMARY KEY (id)
);
CREATE TABLE public.store_price_models (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid UNIQUE,
  price_model character varying NOT NULL DEFAULT 'retail_only'::character varying,
  simple_wholesale_enabled boolean DEFAULT false,
  simple_wholesale_name character varying DEFAULT 'Atacado'::character varying,
  simple_wholesale_min_qty integer DEFAULT 10,
  gradual_wholesale_enabled boolean DEFAULT false,
  gradual_tiers_count integer DEFAULT 2,
  tier_1_name character varying DEFAULT 'Varejo'::character varying,
  tier_2_name character varying DEFAULT 'Atacarejo'::character varying,
  tier_3_name character varying DEFAULT 'Atacado Pequeno'::character varying,
  tier_4_name character varying DEFAULT 'Atacado Grande'::character varying,
  tier_1_enabled boolean DEFAULT true,
  tier_2_enabled boolean DEFAULT false,
  tier_3_enabled boolean DEFAULT false,
  tier_4_enabled boolean DEFAULT false,
  show_price_tiers boolean DEFAULT true,
  show_savings_indicators boolean DEFAULT true,
  show_next_tier_hint boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  minimum_purchase_enabled boolean DEFAULT false,
  minimum_purchase_amount numeric DEFAULT 0.00,
  minimum_purchase_message text DEFAULT 'Pedido mÃ­nimo de R$ {amount} para finalizar a compra'::text,
  CONSTRAINT store_price_models_pkey PRIMARY KEY (id),
  CONSTRAINT store_price_models_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.store_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL UNIQUE,
  payment_methods jsonb DEFAULT '{"pix": false, "bank_slip": false, "credit_card": false}'::jsonb,
  shipping_options jsonb DEFAULT '{"pickup": true, "delivery": false, "shipping": false}'::jsonb,
  whatsapp_number text,
  whatsapp_integration_active boolean DEFAULT false,
  business_hours jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  retail_catalog_active boolean DEFAULT true,
  wholesale_catalog_active boolean DEFAULT false,
  template_name text DEFAULT 'default'::text,
  custom_domain text,
  catalog_url_slug text,
  seo_title text,
  seo_description text,
  seo_keywords text,
  checkout_type text DEFAULT 'both'::text CHECK (checkout_type = ANY (ARRAY['whatsapp'::text, 'online'::text, 'both'::text])),
  show_prices boolean DEFAULT true,
  show_stock boolean DEFAULT true,
  allow_categories_filter boolean DEFAULT true,
  allow_price_filter boolean DEFAULT true,
  facebook_url text,
  instagram_url text,
  twitter_url text,
  business_type text,
  watermark_enabled boolean DEFAULT false,
  watermark_type text DEFAULT 'text'::text CHECK (watermark_type = ANY (ARRAY['text'::text, 'logo'::text])),
  watermark_text text DEFAULT 'Minha Loja'::text,
  watermark_logo_url text,
  watermark_position text DEFAULT 'bottom-right'::text CHECK (watermark_position = ANY (ARRAY['top-left'::text, 'top-right'::text, 'bottom-left'::text, 'bottom-right'::text, 'center'::text])),
  watermark_opacity numeric DEFAULT 0.7 CHECK (watermark_opacity >= 0::numeric AND watermark_opacity <= 1::numeric),
  watermark_size integer DEFAULT 24,
  watermark_color text DEFAULT '#ffffff'::text,
  catalog_mode text DEFAULT 'separated'::text CHECK (catalog_mode = ANY (ARRAY['separated'::text, 'hybrid'::text, 'toggle'::text])),
  primary_color text DEFAULT '#0057FF'::text,
  secondary_color text DEFAULT '#FF6F00'::text,
  accent_color text DEFAULT '#8E2DE2'::text,
  background_color text DEFAULT '#FFFFFF'::text,
  text_color text DEFAULT '#1E293B'::text,
  border_color text DEFAULT '#E2E8F0'::text,
  font_family text DEFAULT 'Inter, system-ui, sans-serif'::text,
  layout_spacing integer DEFAULT 16,
  border_radius integer DEFAULT 8,
  mobile_columns integer DEFAULT 2 CHECK (mobile_columns = ANY (ARRAY[1, 2])),
  privacy_policy_content text,
  terms_of_use_content text,
  returns_policy_content text,
  delivery_policy_content text,
  about_us_content text,
  contact_address text,
  contact_phone text,
  contact_email text,
  business_hours_text text,
  linkedin_url text,
  youtube_url text,
  tiktok_url text,
  footer_enabled boolean DEFAULT true,
  footer_custom_text text,
  footer_copyright_text text,
  checkout_upsell_enabled boolean DEFAULT true,
  urgency_timer_enabled boolean DEFAULT true,
  social_proof_enabled boolean DEFAULT true,
  trust_badges_enabled boolean DEFAULT true,
  quick_add_enabled boolean DEFAULT true,
  business_hours_display_type USER-DEFINED DEFAULT 'summary'::business_hours_display,
  CONSTRAINT store_settings_pkey PRIMARY KEY (id),
  CONSTRAINT store_settings_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);
CREATE TABLE public.store_shipping_methods (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  name character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  is_active boolean DEFAULT true,
  price numeric DEFAULT 0.00,
  estimated_days integer DEFAULT 1,
  config jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT store_shipping_methods_pkey PRIMARY KEY (id)
);
CREATE TABLE public.store_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  plan_id uuid NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'trialing'::subscription_status,
  starts_at timestamp with time zone NOT NULL DEFAULT now(),
  ends_at timestamp with time zone,
  trial_ends_at timestamp with time zone,
  canceled_at timestamp with time zone,
  mercadopago_subscription_id text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT store_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT store_subscriptions_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT store_subscriptions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.subscription_plans(id)
);
CREATE TABLE public.store_variation_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  master_group_id uuid,
  name text NOT NULL,
  description text,
  attribute_key text NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  display_order integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT store_variation_groups_pkey PRIMARY KEY (id),
  CONSTRAINT store_variation_groups_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT store_variation_groups_master_group_id_fkey FOREIGN KEY (master_group_id) REFERENCES public.variation_master_groups(id)
);
CREATE TABLE public.store_variation_values (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  group_id uuid NOT NULL,
  master_value_id uuid,
  value text NOT NULL,
  hex_color text,
  display_order integer DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  grade_sizes jsonb,
  grade_pairs jsonb,
  grade_config jsonb,
  CONSTRAINT store_variation_values_pkey PRIMARY KEY (id),
  CONSTRAINT store_variation_values_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id),
  CONSTRAINT store_variation_values_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.store_variation_groups(id),
  CONSTRAINT store_variation_values_master_value_id_fkey FOREIGN KEY (master_value_id) REFERENCES public.variation_master_values(id)
);
CREATE TABLE public.stores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  owner_id uuid NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  plan_type text NOT NULL DEFAULT 'basic'::text,
  monthly_fee numeric DEFAULT 0.00,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  url_slug text UNIQUE,
  phone text,
  email text,
  address text,
  cnpj text,
  logo_url text,
  CONSTRAINT stores_pkey PRIMARY KEY (id),
  CONSTRAINT stores_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.subscription_plans (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  type USER-DEFINED NOT NULL UNIQUE,
  description text,
  price_monthly numeric NOT NULL,
  price_yearly numeric,
  is_active boolean NOT NULL DEFAULT true,
  trial_days integer DEFAULT 7,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT subscription_plans_pkey PRIMARY KEY (id)
);
CREATE TABLE public.system_benefits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  benefit_key text NOT NULL UNIQUE,
  category text NOT NULL DEFAULT 'general'::text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT system_benefits_pkey PRIMARY KEY (id)
);
CREATE TABLE public.variation_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  primary_attribute text NOT NULL,
  secondary_attribute text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT variation_groups_pkey PRIMARY KEY (id),
  CONSTRAINT variation_groups_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.variation_master_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  attribute_key text NOT NULL UNIQUE,
  is_active boolean NOT NULL DEFAULT true,
  display_order integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT variation_master_groups_pkey PRIMARY KEY (id)
);
CREATE TABLE public.variation_master_values (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL,
  value text NOT NULL,
  hex_color text,
  display_order integer DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  grade_sizes jsonb,
  grade_pairs jsonb,
  CONSTRAINT variation_master_values_pkey PRIMARY KEY (id),
  CONSTRAINT variation_master_values_group_id_fkey FOREIGN KEY (group_id) REFERENCES public.variation_master_groups(id)
);
CREATE TABLE public.whatsapp_integrations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL,
  instance_name text NOT NULL UNIQUE,
  status text NOT NULL DEFAULT 'disconnected'::text CHECK (status = ANY (ARRAY['disconnected'::text, 'connecting'::text, 'connected'::text, 'error'::text])),
  evolution_api_url text,
  evolution_api_token text,
  connection_status text DEFAULT 'disconnected'::text,
  last_connected_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT whatsapp_integrations_pkey PRIMARY KEY (id),
  CONSTRAINT whatsapp_integrations_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id)
);